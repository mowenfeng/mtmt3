<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>éŸ³ä¹è½¬è°± - ä»å¬è§åˆ°æ¼”å¥ï¼Œåªæœ‰ä¸€ä¸ªAIçš„è·ç¦»</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      color: #333;
      line-height: 1.6;
      background: #fff;
    }

    /* å¯¼èˆªæ  */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      padding: 0 5%;
    }

    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 70px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      color: #6366f1;
      text-decoration: none;
    }

    .nav-links {
      display: flex;
      gap: 30px;
      list-style: none;
    }

    .nav-links a {
      text-decoration: none;
      color: #333;
      font-size: 16px;
      transition: color 0.3s;
    }

    .nav-links a:hover {
      color: #6366f1;
    }

    .nav-actions {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .btn-login {
      padding: 8px 20px;
      background: transparent;
      border: 1px solid #6366f1;
      color: #6366f1;
      border-radius: 20px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s;
    }

    .btn-login:hover {
      background: #6366f1;
      color: white;
    }

    /* è‹±é›„åŒºåŸŸ */
    .hero {
      margin-top: 70px;
      padding: 100px 5% 80px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-align: center;
    }

    .hero h1 {
      font-size: 48px;
      margin-bottom: 20px;
      font-weight: 700;
    }

    .hero p {
      font-size: 24px;
      margin-bottom: 40px;
      opacity: 0.95;
    }

    /* åŠŸèƒ½å¡ç‰‡åŒºåŸŸ */
    .features {
      padding: 80px 5%;
      max-width: 1200px;
      margin: 0 auto;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 30px;
      margin-top: 50px;
    }

    .feature-card {
      background: white;
      border-radius: 12px;
      padding: 40px 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
    }

    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }

    .feature-card.active {
      border: 2px solid #6366f1;
    }

    .feature-icon {
      font-size: 48px;
      margin-bottom: 20px;
    }

    .feature-card h3 {
      font-size: 22px;
      margin-bottom: 15px;
      color: #333;
    }

    .feature-card p {
      color: #666;
      font-size: 15px;
      line-height: 1.8;
    }

    .feature-badge {
      display: inline-block;
      padding: 4px 12px;
      background: #f0f9ff;
      color: #6366f1;
      border-radius: 12px;
      font-size: 12px;
      margin-top: 15px;
    }

    /* è½¬è°±åŠŸèƒ½åŒºåŸŸ */
    .transcription-section {
      padding: 80px 5%;
      background: #f8fafc;
      min-height: 600px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 50px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .section-title {
      text-align: center;
      font-size: 32px;
      margin-bottom: 50px;
      color: #333;
    }

    .form-group {
      margin-bottom: 25px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
      font-size: 15px;
    }

    .form-group input[type="file"],
    .form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 15px;
      transition: border-color 0.3s;
    }

    .form-group input[type="file"]:focus,
    .form-group select:focus {
      outline: none;
      border-color: #6366f1;
    }

    .btn-primary {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .status-panel {
      margin-top: 30px;
      padding: 25px;
      background: #f8fafc;
      border-radius: 8px;
      display: none;
    }

    .status-panel.active {
      display: block;
    }

    .status-item {
      margin-bottom: 15px;
      font-size: 15px;
    }

    .status-item strong {
      color: #6366f1;
      margin-right: 10px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      margin: 15px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      width: 0%;
      transition: width 0.3s;
    }

    .download-links {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
    }

    .download-links a {
      display: inline-block;
      margin-right: 15px;
      padding: 10px 20px;
      background: #6366f1;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      transition: background 0.3s;
    }

    .download-links a:hover {
      background: #4f46e5;
    }

    .log {
      margin-top: 20px;
      padding: 15px;
      background: #1f2937;
      color: #10b981;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      display: none;
    }

    .log.active {
      display: block;
    }

    /* ä¼šå‘˜æƒç›ŠåŒºåŸŸ */
    .membership {
      padding: 80px 5%;
      background: white;
    }

    .membership-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      max-width: 1200px;
      margin: 50px auto 0;
    }

    .membership-card {
      border: 2px solid #e5e7eb;
      border-radius: 16px;
      padding: 40px 30px;
      text-align: center;
      transition: all 0.3s;
    }

    .membership-card:hover {
      border-color: #6366f1;
      transform: translateY(-5px);
    }

    .membership-card h3 {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .membership-price {
      font-size: 36px;
      font-weight: bold;
      color: #6366f1;
      margin: 20px 0;
    }

    .membership-features {
      list-style: none;
      text-align: left;
      margin: 30px 0;
    }

    .membership-features li {
      padding: 10px 0;
      border-bottom: 1px solid #f3f4f6;
    }

    .membership-features li:before {
      content: "âœ“ ";
      color: #10b981;
      font-weight: bold;
      margin-right: 10px;
    }

    /* é¡µè„š */
    .footer {
      background: #1f2937;
      color: white;
      padding: 50px 5%;
      text-align: center;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .footer-links a {
      color: #9ca3af;
      text-decoration: none;
      transition: color 0.3s;
    }

    .footer-links a:hover {
      color: white;
    }

    .footer-copyright {
      margin-top: 30px;
      padding-top: 30px;
      border-top: 1px solid #374151;
      color: #9ca3af;
      font-size: 14px;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .hero h1 {
        font-size: 32px;
      }

      .hero p {
        font-size: 18px;
      }

      .nav-links {
        display: none;
      }

      .features-grid {
        grid-template-columns: 1fr;
      }

      .container {
        padding: 30px 20px;
      }

      .membership-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- å¯¼èˆªæ  -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="#" class="logo">éŸ³ä¹è½¬è°±</a>
      <ul class="nav-links">
        <li><a href="#home">é¦–é¡µ</a></li>
        <li><a href="#features">åŠŸèƒ½äº§å“</a></li>
        <li><a href="#transcription">è½¬è°±</a></li>
        <li><a href="#membership">ä¼šå‘˜</a></li>
      </ul>
      <div class="nav-actions">
        <a href="#" class="btn-login">ç™»å½•</a>
      </div>
    </div>
  </nav>

  <!-- è‹±é›„åŒºåŸŸ -->
  <section class="hero" id="home">
    <h1>ä»å¬è§åˆ°æ¼”å¥ï¼Œåªæœ‰ä¸€ä¸ªAIçš„è·ç¦»</h1>
    <p>å°†éŸ³ä¹è½¬å½•ä¸ºäº”çº¿è°±ä¸ç®€è°±ï¼Œè®©éŸ³ä¹åˆ›ä½œæ›´ç®€å•</p>
  </section>

  <!-- åŠŸèƒ½å±•ç¤ºåŒºåŸŸ -->
  <section class="features" id="features">
    <h2 class="section-title">æ ¸å¿ƒåŠŸèƒ½</h2>
    <div class="features-grid">
      <div class="feature-card" onclick="scrollToSection('transcription')" role="button" tabindex="0" onkeypress="if(event.key==='Enter') scrollToSection('transcription')">
        <div class="feature-icon">ğŸµ</div>
        <h3>éŸ³ä¹è½¬è°±</h3>
        <p>å°†éŸ³ä¹è½¬å½•ä¸ºäº”çº¿è°±ä¸ç®€è°±</p>
        <span class="feature-badge">æœ€å¤šäººçš„é€‰æ‹©</span>
      </div>
      <div class="feature-card">
        <div class="feature-icon">ğŸ“„</div>
        <h3>å›¾æ–‡è¯†è°±</h3>
        <p>è¯†åˆ«äº”çº¿è°±å›¾ç‰‡/PDFæ–‡ä»¶</p>
        <span class="feature-badge">æœ€æ–°åŠŸèƒ½æ¨è</span>
      </div>
      <div class="feature-card">
        <div class="feature-icon">ğŸ¤</div>
        <h3>äººå£°åˆ†ç¦»</h3>
        <p>å°†éŸ³ä¹åˆ†ç¦»æˆäººå£°ä¸ä¼´å¥</p>
        <span class="feature-badge">çƒ­é—¨åŠŸèƒ½æ¨è</span>
      </div>
      <div class="feature-card">
        <div class="feature-icon">ğŸ¹</div>
        <h3>æ›²è°±è½¬æ¢</h3>
        <p>å°† MIDI è½¬æ¢ä¸ºäº”çº¿è°±ä¸ç®€è°±</p>
        <span class="feature-badge">äº®ç‚¹åŠŸèƒ½æ¨è</span>
      </div>
    </div>
  </section>

  <!-- è½¬è°±åŠŸèƒ½åŒºåŸŸ -->
  <section class="transcription-section" id="transcription">
    <div class="container">
      <h2 class="section-title">éŸ³ä¹è½¬è°±</h2>
      
      <div class="form-group">
        <label for="fileInput">é€‰æ‹©éŸ³é¢‘æ–‡ä»¶</label>
        <input type="file" id="fileInput" accept="audio/*" />
      </div>

      <div class="form-group">
        <label for="model">æ¨¡å‹</label>
        <select id="model">
          <option value="mtmt3_piano_vocal">é’¢ç´ + äººå£°</option>
          <option value="mtmt3_multi">å¤šä¹å™¨</option>
        </select>
      </div>

      <div class="form-group">
        <label for="mode">éŸ³ä¹å½¢å¼</label>
        <select id="mode">
          <option value="with_accompaniment">å¸¦ä¼´å¥æ¼”å”±</option>
          <option value="a_cappella">æ— ä¼´å¥æ¸…å”±</option>
          <option value="instrumental">çº¯ä¹å™¨æ¼”å¥</option>
        </select>
      </div>

      <div class="form-group">
        <label for="quantization">é‡åŒ–ç²¾åº¦</label>
        <select id="quantization">
          <option value="none">æ— </option>
          <option value="1/4">1/4</option>
          <option value="1/8">1/8</option>
          <option value="1/16">1/16</option>
        </select>
      </div>

      <button class="btn-primary" id="uploadBtn">ä¸Šä¼ å¹¶è½¬è°±</button>

      <div class="status-panel" id="statusPanel">
        <div class="status-item">
          <strong>ä»»åŠ¡ID:</strong> <span id="taskId">-</span>
        </div>
        <div class="status-item">
          <strong>çŠ¶æ€:</strong> <span id="status">-</span>
        </div>
        <div class="status-item">
          <strong>è¿›åº¦:</strong> <span id="progress">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="download-links" id="downloadLinks"></div>
      </div>

      <div class="log" id="log"></div>
    </div>
  </section>

  <!-- ä¼šå‘˜æƒç›ŠåŒºåŸŸ -->
  <section class="membership" id="membership">
    <h2 class="section-title">ä¼šå‘˜æƒç›Š</h2>
    <div class="membership-grid">
      <div class="membership-card">
        <h3>éŸ³ä¹ç”Ÿ</h3>
        <div class="membership-price">æ°¸ä¹…å…è´¹</div>
        <ul class="membership-features">
          <li>æ¯æ—¥ç­¾åˆ°é€ 2 éŸ³ç¬¦</li>
          <li>éŸ³ä¹è½¬è°±/äººå£°åˆ†ç¦»/æ›²è°±è½¬æ¢</li>
          <li>åœ¨çº¿é¢„è§ˆ/ä¸‹è½½</li>
          <li>æ”¯æŒ 20MB éŸ³ä¹</li>
          <li>æ”¯æŒ 10 åˆ†é’ŸéŸ³ä¹</li>
          <li>æ•°æ®ä¿å­˜ä¸‰å¤©</li>
          <li>å•ä¸ªä¸Šä¼ å¤„ç†</li>
        </ul>
      </div>
      <div class="membership-card">
        <h3>ä¼šå‘˜ VIP</h3>
        <div class="membership-price">Â¥ 0</div>
        <p style="color: #666; margin-bottom: 20px;">æ‚¨å¯ä»¥é€šè¿‡å¼€é€šä¼šå‘˜æ¥è·å–æ›´å¤šæƒç›Š</p>
        <ul class="membership-features">
          <li>æ›´å¤šå¤„ç†æ¬¡æ•°</li>
          <li>æ›´å¤§æ–‡ä»¶æ”¯æŒ</li>
          <li>æ›´é•¿éŸ³é¢‘å¤„ç†</li>
          <li>æ•°æ®æ°¸ä¹…ä¿å­˜</li>
          <li>æ‰¹é‡ä¸Šä¼ å¤„ç†</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- é¡µè„š -->
  <footer class="footer">
    <div class="footer-links">
      <a href="#">åŠŸèƒ½åœ°å›¾</a>
      <a href="#">è§„åˆ™æ¡æ¬¾</a>
      <a href="#">éšç§æ”¿ç­–</a>
      <a href="#">å…³äºæˆ‘ä»¬</a>
      <a href="#">å•†åŠ¡åˆä½œ</a>
      <a href="#">æ„è§åé¦ˆ</a>
    </div>
    <div class="footer-copyright">
      <p>Â© 2024 éŸ³ä¹è½¬è°±å¹³å° | è®©éŸ³ä¹åˆ›ä½œæ›´ç®€å•</p>
    </div>
  </footer>

  <script>
    const API_BASE = "http://127.0.0.1:8000";

    const $ = (id) => document.getElementById(id);

    function log(msg) {
      const logEl = $("log");
      logEl.classList.add("active");
      logEl.textContent += msg + "\n";
      logEl.scrollTop = logEl.scrollHeight;
    }

    function scrollToSection(id) {
      document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
    }

    $("uploadBtn").onclick = async () => {
      const file = $("fileInput").files[0];
      if (!file) {
        alert("è¯·å…ˆé€‰æ‹©éŸ³é¢‘æ–‡ä»¶");
        return;
      }

      const form = new FormData();
      form.append("file", file);
      form.append("model", $("model").value);
      form.append("mode", $("mode").value);
      form.append("quantization", $("quantization").value);

      log("ä¸Šä¼ ä¸­...");
      $("statusPanel").classList.add("active");
      $("status").textContent = "ä¸Šä¼ ä¸­...";
      $("progress").textContent = "0%";
      $("progressFill").style.width = "0%";
      $("downloadLinks").innerHTML = "";

      try {
        const resp = await fetch(API_BASE + "/api/tasks", {
          method: "POST",
          body: form,
        });

        const data = await resp.json();
        log("åˆ›å»ºä»»åŠ¡: " + JSON.stringify(data));

        $("taskId").textContent = data.task_id;
        $("status").textContent = "å¤„ç†ä¸­...";
        pollStatus(data.task_id);
      } catch (error) {
        log("é”™è¯¯: " + error.message);
        $("status").textContent = "å¤±è´¥";
      }
    };

    async function pollStatus(taskId) {
      let pollInterval = 5000; // åˆå§‹è½®è¯¢é—´éš”5ç§’
      let consecutiveErrors = 0;
      
      async function tick() {
        try {
          const resp = await fetch(API_BASE + "/api/tasks/" + taskId);
          const data = await resp.json();
          
          consecutiveErrors = 0; // é‡ç½®é”™è¯¯è®¡æ•°
          pollInterval = 5000; // é‡ç½®ä¸ºé»˜è®¤é—´éš”
          
          $("status").textContent = data.status === "done" ? "å®Œæˆ" : 
                                   data.status === "failed" ? "å¤±è´¥" : "å¤„ç†ä¸­...";
          
          const progress = (data.progress * 100).toFixed(0);
          $("progress").textContent = progress + "%";
          $("progressFill").style.width = progress + "%";

          if (data.status === "done" && data.result) {
            const d = data.result;
            $("downloadLinks").innerHTML =
              `<a href="${API_BASE + d.midi_url}" target="_blank">ä¸‹è½½ MIDI</a>` +
              `<a href="${API_BASE + d.musicxml_url}" target="_blank">ä¸‹è½½ MusicXML</a>`;
            log("ä»»åŠ¡å®Œæˆï¼");
          } else if (data.status === "failed") {
            log("ä»»åŠ¡å¤±è´¥: " + (data.error_message || "æœªçŸ¥é”™è¯¯"));
          } else {
            // å¦‚æœå¤„ç†æ—¶é—´è¾ƒé•¿ï¼Œé€æ¸å¢åŠ è½®è¯¢é—´éš”ï¼ˆæœ€å¤š10ç§’ï¼‰
            setTimeout(tick, pollInterval);
            pollInterval = Math.min(pollInterval + 1000, 10000);
          }
        } catch (error) {
          consecutiveErrors++;
          log("è½®è¯¢é”™è¯¯: " + error.message);
          // å¦‚æœè¿ç»­å‡ºé”™ï¼Œå¢åŠ è½®è¯¢é—´éš”
          if (consecutiveErrors > 3) {
            pollInterval = Math.min(pollInterval * 1.5, 15000);
          }
          setTimeout(tick, pollInterval);
        }
      }
      tick();
    }

    // å¹³æ»‘æ»šåŠ¨
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });
  </script>
</body>
</html>
# éŸ³ä¹è½¬è°±æœåŠ¡

åŸºäºMR-MT3æ¨¡å‹çš„éŸ³ä¹è½¬è°±æœåŠ¡ï¼Œæ”¯æŒå°†éŸ³é¢‘æ–‡ä»¶è½¬æ¢ä¸ºMIDIå’ŒMusicXMLæ ¼å¼ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸµ éŸ³ä¹è½¬è°±ï¼šå°†éŸ³é¢‘è½¬å½•ä¸ºäº”çº¿è°±ä¸ç®€è°±
- ğŸ“„ å›¾æ–‡è¯†è°±ï¼šè¯†åˆ«äº”çº¿è°±å›¾ç‰‡/PDFæ–‡ä»¶ï¼ˆè§„åˆ’ä¸­ï¼‰
- ğŸ¤ äººå£°åˆ†ç¦»ï¼šå°†éŸ³ä¹åˆ†ç¦»æˆäººå£°ä¸ä¼´å¥ï¼ˆè§„åˆ’ä¸­ï¼‰
- ğŸ¹ æ›²è°±è½¬æ¢ï¼šå°†MIDIè½¬æ¢ä¸ºäº”çº¿è°±ä¸ç®€è°±ï¼ˆè§„åˆ’ä¸­ï¼‰

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd mtmt3/backend
pip install -r requirements.txt
```

æˆ–è€…ä½¿ç”¨æä¾›çš„æ‰¹å¤„ç†æ–‡ä»¶ï¼ˆWindowsï¼‰ï¼š
```bash
install_dependencies.bat
```

### 2. å¯åŠ¨æœåŠ¡

#### æ–¹å¼ä¸€ï¼šåŒæ—¶å¯åŠ¨APIå’ŒWorkerï¼ˆæ¨èï¼‰

**Windows:**
```bash
start_all.bat
```

**Linux/Mac:**
```bash
python start_server.py
```

#### æ–¹å¼äºŒï¼šåˆ†åˆ«å¯åŠ¨

**å¯åŠ¨APIæœåŠ¡å™¨ï¼š**
```bash
# Windows
start_api.bat

# Linux/Mac (ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ)
python -m uvicorn backend.main:app --reload --port 8000
```

**å¯åŠ¨Workerï¼ˆæ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼‰ï¼š**
```bash
# Windows
start_worker.bat

# Linux/Mac
python -m backend.worker
```

### 3. è®¿é—®æœåŠ¡

å¯åŠ¨æœåŠ¡åï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š

- **å‰ç«¯ç”¨æˆ·ç•Œé¢**: http://127.0.0.1:8000
- **APIæ–‡æ¡£**: http://127.0.0.1:8000/docs
- **APIåœ°å€**: http://127.0.0.1:8000/api

**æ³¨æ„**: å‰ç«¯é¡µé¢å·²é›†æˆåˆ°APIæœåŠ¡ä¸­ï¼Œç›´æ¥è®¿é—® http://127.0.0.1:8000 å³å¯ä½¿ç”¨å®Œæ•´çš„ç”¨æˆ·ç•Œé¢ã€‚

## ä½¿ç”¨è¯´æ˜

### é€šè¿‡å‰ç«¯é¡µé¢ä½¿ç”¨

1. æ‰“å¼€ `frontend/index.html` æ–‡ä»¶
2. é€‰æ‹©éŸ³é¢‘æ–‡ä»¶ï¼ˆæ”¯æŒå¸¸è§éŸ³é¢‘æ ¼å¼ï¼‰
3. é€‰æ‹©æ¨¡å‹ï¼š
   - `mtmt3_piano_vocal`: é’¢ç´ + äººå£°
   - `mtmt3_multi`: å¤šä¹å™¨
4. é€‰æ‹©éŸ³ä¹å½¢å¼ï¼š
   - `with_accompaniment`: å¸¦ä¼´å¥æ¼”å”±
   - `a_cappella`: æ— ä¼´å¥æ¸…å”±
   - `instrumental`: çº¯ä¹å™¨æ¼”å¥
5. é€‰æ‹©é‡åŒ–ç²¾åº¦ï¼ˆå¯é€‰ï¼‰
6. ç‚¹å‡»"ä¸Šä¼ å¹¶è½¬è°±"
7. ç­‰å¾…å¤„ç†å®Œæˆï¼Œä¸‹è½½MIDIæˆ–MusicXMLæ–‡ä»¶

### é€šè¿‡APIä½¿ç”¨

#### åˆ›å»ºè½¬è°±ä»»åŠ¡

```bash
curl -X POST "http://127.0.0.1:8000/api/tasks" \
  -F "file=@your_audio.wav" \
  -F "model=mtmt3_piano_vocal" \
  -F "mode=with_accompaniment" \
  -F "quantization=none"
```

å“åº”ï¼š
```json
{
  "task_id": "uuid-string",
  "status": "queued"
}
```

#### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```bash
curl "http://127.0.0.1:8000/api/tasks/{task_id}"
```

å“åº”ï¼š
```json
{
  "task_id": "uuid-string",
  "status": "done",
  "progress": 1.0,
  "result": {
    "midi_url": "/download/{task_id}.mid",
    "musicxml_url": "/download/{task_id}.musicxml",
    "duration": 120.5,
    "note_count": 500
  }
}
```

#### ä¸‹è½½ç»“æœæ–‡ä»¶

```bash
# ä¸‹è½½MIDI
curl "http://127.0.0.1:8000/download/{task_id}.mid" -o output.mid

# ä¸‹è½½MusicXML
curl "http://127.0.0.1:8000/download/{task_id}.musicxml" -o output.musicxml
```

## é¡¹ç›®ç»“æ„

```
mtmt3/
â”œâ”€â”€ backend/              # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ main.py          # FastAPIåº”ç”¨
â”‚   â”œâ”€â”€ worker.py        # åå°ä»»åŠ¡å¤„ç†
â”‚   â”œâ”€â”€ config.py        # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ db.py            # æ•°æ®åº“æ¨¡å‹
â”‚   â”œâ”€â”€ requirements.txt # Pythonä¾èµ–
â”‚   â””â”€â”€ mtmt3_core/      # è½¬è°±æ ¸å¿ƒæ¨¡å—
â”‚       â””â”€â”€ transcriber.py
â”œâ”€â”€ frontend/            # å‰ç«¯é¡µé¢
â”‚   â””â”€â”€ index.html       # ä¸»é¡µé¢
â”œâ”€â”€ start_all.bat        # å¯åŠ¨è„šæœ¬ï¼ˆWindowsï¼‰
â”œâ”€â”€ start_api.bat        # å¯åŠ¨APIï¼ˆWindowsï¼‰
â”œâ”€â”€ start_worker.bat     # å¯åŠ¨Workerï¼ˆWindowsï¼‰
â””â”€â”€ README.md           # æœ¬æ–‡ä»¶
```

## æŠ€æœ¯æ ˆ

- **åç«¯**: FastAPI, SQLAlchemy, Uvicorn
- **æ¨¡å‹**: MR-MT3 (CPUç‰ˆæœ¬)
- **éŸ³é¢‘å¤„ç†**: librosa, torchaudio
- **MIDIå¤„ç†**: mido, pretty-midi
- **MusicXML**: music21
- **å‰ç«¯**: HTML, CSS, JavaScript

## æ³¨æ„äº‹é¡¹

1. **CPUæ¨¡å¼**: å½“å‰ä½¿ç”¨CPUç‰ˆæœ¬çš„MR-MT3æ¨¡å‹ï¼Œå¤„ç†é€Ÿåº¦è¾ƒæ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…
2. **æ–‡ä»¶å¤§å°**: å»ºè®®éŸ³é¢‘æ–‡ä»¶ä¸è¶…è¿‡20MBï¼Œæ—¶é•¿ä¸è¶…è¿‡10åˆ†é’Ÿ
3. **éŸ³é¢‘æ ¼å¼**: æ”¯æŒå¸¸è§éŸ³é¢‘æ ¼å¼ï¼ˆwav, mp3, flacç­‰ï¼‰
4. **æ•°æ®åº“**: ä½¿ç”¨SQLiteå­˜å‚¨ä»»åŠ¡ä¿¡æ¯ï¼Œæ•°æ®åº“æ–‡ä»¶ä½äº `backend/db.sqlite3`
5. **æ•°æ®ç›®å½•**: ä¸Šä¼ æ–‡ä»¶å’Œç»“æœæ–‡ä»¶å­˜å‚¨åœ¨ `backend/data/` ç›®å½•ä¸‹

## æ•…éšœæ’é™¤

### æœåŠ¡æ— æ³•å¯åŠ¨

1. æ£€æŸ¥Pythonç‰ˆæœ¬ï¼ˆå»ºè®®3.8+ï¼‰
2. ç¡®è®¤æ‰€æœ‰ä¾èµ–å·²æ­£ç¡®å®‰è£…
3. æ£€æŸ¥ç«¯å£8000æ˜¯å¦è¢«å ç”¨

### è½¬è°±å¤±è´¥

1. æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æ˜¯å¦æŸå
2. æŸ¥çœ‹workeræ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
3. ç¡®è®¤æ¨¡å‹æ–‡ä»¶å·²æ­£ç¡®ä¸‹è½½ï¼ˆé¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½ï¼‰

### å‰ç«¯æ— æ³•è¿æ¥API

1. ç¡®è®¤APIæœåŠ¡å·²å¯åŠ¨
2. æ£€æŸ¥ `frontend/index.html` ä¸­çš„ `API_BASE` åœ°å€æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰CORSé”™è¯¯

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–è”ç³»å¼€å‘è€…ã€‚
